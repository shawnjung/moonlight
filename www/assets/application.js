(function(){window.PiG={Model:{},Collection:{},View:{},Helper:{}}}).call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Model.Actor=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(SUI.Model)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Model.Asset=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(Backbone.Model)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Model.Choice=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(SUI.Model)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Model.Event=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(Backbone.Model)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Model.Game=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(){return this.scenes=new PiG.Collection.Scenes,this.assets=new PiG.Collection.Assets},n.prototype.init_assets=function(e){return this.assets.reset(e)},n.prototype.init_scenes=function(e){return this.scenes.reset(e)},n.prototype.init_game_data_from=function(e){return this.init_assets(e.assets),_(e.scenes).each(function(e){return function(t){var n;return n=new e.scenes.model(t),n.init_actors(t.actors),n.init_layers(t.layers),n.init_pre_scene_events(t.pre_scene_events||t.preevents),n.init_post_scene_events(t.post_scene_events),n.init_events(t.events),n.init_dynamic_events(t.dynamic_events),e.scenes.add(n)}}(this))},n.prototype.preload_assets=function(e){var t;return this.loaded_assets=0,t=function(t){return function(){return t.loaded_assets===t.assets.length?e():void 0}}(this),this.assets.each(function(e){return function(n){return e["_preload_"+n.get("type")](n,t)}}(this))},n.prototype._preload_image=function(e,t){var n;return n=new Image,n.onload=function(i){return function(){return i.loaded_assets++,e.set("width",n.width),e.set("height",n.height),t()}}(this),n.src=e.get("src")},n.prototype._preload_audio=function(e,t){var n;return n=new Howl({src:[e.get("src")],html5:e.get("buffer")||!1,onload:function(i){return function(){return e.audio=n,i.loaded_assets++,t()}}(this)})},n}(SUI.Model)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Model.Layer=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(Backbone.Model)}.call(this),function(){PiG.Model.LimitedTimeScene={}}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Model.LimitedTimeScene.Time=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(){return this._init_seconds(),this.on("change:time",this._init_seconds)},n.prototype.subtract=function(e){var t;return t=this.get("seconds")-this._parse_time(e),0>t&&(t=0),this.set("seconds",t)},n.prototype.add=function(e){return this.set("seconds",this.get("seconds")+this._parse_time(e))},n.prototype.reset=function(e){return this.set("seconds",this._parse_time(e))},n.prototype.humanize=function(){var e,t,n;return t=this.get("seconds"),e={},n=0,e.hours=Math.floor(t/3600),n+=3600*e.hours,e.minutes=Math.floor((t-n)/60),n+=60*e.minutes,e.seconds=t-n,e},n.prototype._init_seconds=function(){return this.set("seconds",this._parse_time(this.get("time")))},n.prototype._parse_time=function(e){if(!_(e).isArray())return parseInt(e);if(e[0]=parseInt(e[0]),_(e[0]).isNaN())return 0;switch(e[1]){case"seconds":case"second":return e[0];case"minutes":case"minute":return 60*e[0];case"hours":case"hour":return 60*e[0]*60;default:return e[0]}},n}(SUI.Model)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Model.Message=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(SUI.Model)}.call(this),function(){var extend=function(e,t){function n(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;PiG.Model.Scene=function(superClass){function Scene(){return Scene.__super__.constructor.apply(this,arguments)}return extend(Scene,superClass),Scene.prototype.view_namespace="PiG.View",Scene.prototype.initialize=function(){return this.actors=new PiG.Collection.Actors,this.layers=new PiG.Collection.Layers,this.events=new PiG.Collection.Events,this.pre_scene_events=new PiG.Collection.Events,this.post_scene_events=new PiG.Collection.Events,this.dynamic_events=new PiG.Collection.Events},Scene.prototype.init_actors=function(e){return this.actors.reset(e)},Scene.prototype.init_layers=function(e){return this.layers.reset(e)},Scene.prototype.init_events=function(e){return this.events.reset(e)},Scene.prototype.init_pre_scene_events=function(e){return this.pre_scene_events.reset(e)},Scene.prototype.init_post_scene_events=function(e){return this.post_scene_events.reset(e)},Scene.prototype.init_dynamic_events=function(e){return this.dynamic_events.reset(e)},Scene.prototype.load_view_class=function(){var namespace,output;return namespace=eval(this.view_namespace),output=namespace[this.get("view")],output||(output=namespace.SceneView),output},Scene}(Backbone.Model)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Collection.Actors=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(SUI.Collection)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Collection.Assets=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=PiG.Model.Asset,n}(Backbone.Collection)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Collection.Choices=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=PiG.Model.Choice,n}(SUI.Collection)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Collection.Events=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=PiG.Model.Event,n}(Backbone.Collection)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Collection.Layers=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=PiG.Model.Layer,n}(Backbone.Collection)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Collection.Messages=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=PiG.Model.Message,n}(SUI.Collection)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.Collection.Scenes=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=PiG.Model.Scene,n}(Backbone.Collection)}.call(this),function(){PiG.Helper.ViewManager=function(){function e(){this.views={}}return e.prototype.add=function(e,t){return this.views[e]=t},e.prototype.get=function(e){return this.views[e]},e.prototype.remove=function(e){var t;return t=this.get(e),delete this.views[e],t},e}()}.call(this),/*! howler.js v2.0.0-beta | (c) 2013-2015, James Simpson of GoldFire Studios | MIT License | howlerjs.com */
!function(){"use strict";function e(){try{"undefined"!=typeof AudioContext?t=new AudioContext:"undefined"!=typeof webkitAudioContext?t=new webkitAudioContext:n=!1}catch(e){n=!1}if(!n)if("undefined"!=typeof Audio)try{new Audio}catch(e){i=!0}else i=!0}var t=null,n=!0,i=!1;if(e(),n){var o="undefined"==typeof t.createGain?t.createGainNode():t.createGain();o.gain.value=1,o.connect(t.destination)}var r=function(){this.init()};r.prototype={init:function(){var e=this||s;return e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e.iOSAutoEnable=!0,e.noAudio=i,e.usingWebAudio=n,e.ctx=t,i||e._setupCodecs(),e},volume:function(e){var t=this||s;if(e=parseFloat(e),"undefined"!=typeof e&&e>=0&&1>=e){t._volume=e,n&&(o.gain.value=e);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var r=t._howls[i]._getSoundIds(),a=0;a<r.length;a++){var u=t._howls[i]._soundById(r[a]);u&&u._node&&(u._node.volume=u._volume*e)}return t}return t._volume},mute:function(e){var t=this||s;t._muted=e,n&&(o.gain.value=e?0:t._volume);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var r=t._howls[i]._getSoundIds(),a=0;a<r.length;a++){var u=t._howls[i]._soundById(r[a]);u&&u._node&&(u._node.muted=e?!0:u._muted)}return t},codecs:function(e){return(this||s)._codecs[e]},_setupCodecs:function(){var e=this||s,t=new Audio,n=t.canPlayType("audio/mpeg;").replace(/^no$/,"");return e._codecs={mp3:!(!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")},e},_enableiOSAudio:function(){var e=this||s;if(!t||!e._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){e._iOSEnabled=!1;var n=function(){var i=t.createBuffer(1,1,22050),o=t.createBufferSource();o.buffer=i,o.connect(t.destination),"undefined"==typeof o.start?o.noteOn(0):o.start(0),setTimeout(function(){(o.playbackState===o.PLAYING_STATE||o.playbackState===o.FINISHED_STATE)&&(e._iOSEnabled=!0,e.iOSAutoEnable=!1,document.removeEventListener("touchstart",n,!1))},0)};return document.addEventListener("touchstart",n,!1),e}}};var s=new r,a=function(e){var t=this;return e.src&&0!==e.src.length?void t.init(e):void console.error("An array of source files must be passed with any new Howl.")};a.prototype={init:function(e){var i=this;return i._autoplay=e.autoplay||!1,i._ext=e.ext||null,i._html5=e.html5||!1,i._muted=e.mute||!1,i._loop=e.loop||!1,i._pool=e.pool||5,i._preload="boolean"==typeof e.preload?e.preload:!0,i._rate=e.rate||1,i._sprite=e.sprite||{},i._src="string"!=typeof e.src?e.src:[e.src],i._volume=void 0!==e.volume?e.volume:1,i._duration=0,i._loaded=!1,i._sounds=[],i._endTimers={},i._onend=e.onend?[{fn:e.onend}]:[],i._onfaded=e.onfaded?[{fn:e.onfaded}]:[],i._onload=e.onload?[{fn:e.onload}]:[],i._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],i._onpause=e.onpause?[{fn:e.onpause}]:[],i._onplay=e.onplay?[{fn:e.onplay}]:[],i._webAudio=n&&!i._html5,"undefined"!=typeof t&&t&&s.iOSAutoEnable&&s._enableiOSAudio(),s._howls.push(i),i._preload&&i.load(),i},load:function(){var e=this,t=null;if(i)return void e._emit("loaderror");"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var o,r;if(e._ext&&e._ext[n]?o=e._ext[n]:(r=e._src[n],o=/^data:audio\/([^;,]+);/i.exec(r),o||(o=/\.([^.]+)$/.exec(r.split("?",1)[0])),o&&(o=o[1].toLowerCase())),s.codecs(o)){t=e._src[n];break}}return t?(e._src=t,new u(e),e._webAudio&&p(e),e):void e._emit("loaderror")},play:function(e){var n=this,i=arguments,o=null;if("number"==typeof e)o=e,e=null;else if("undefined"==typeof e){e="__default";for(var r=0,a=0;a<n._sounds.length;a++)n._sounds[a]._paused&&!n._sounds[a]._ended&&(r++,o=n._sounds[a]._id);1===r?e=null:o=null}var u=o?n._soundById(o):n._inactiveSound();if(!u)return null;if(o&&!e&&(e=u._sprite||"__default"),!n._loaded&&!n._sprite[e])return n.once("load",function(){n.play(n._soundById(u._id)?u._id:void 0)}),u._id;if(o&&!u._paused)return u._id;var c=u._seek>0?u._seek:n._sprite[e][0]/1e3,p=(n._sprite[e][0]+n._sprite[e][1])/1e3-c,_=function(){var i=!(!u._loop&&!n._sprite[e][2]);n._emit("end",u._id),!n._webAudio&&i&&n.stop(u._id).play(u._id),n._webAudio&&i&&(n._emit("play",u._id),u._seek=u._start||0,u._playStart=t.currentTime,n._endTimers[u._id]=setTimeout(_,1e3*(u._stop-u._start)/Math.abs(n._rate))),n._webAudio&&!i&&(u._paused=!0,u._ended=!0,u._seek=u._start||0,n._clearTimer(u._id),u._node.bufferSource=null),n._webAudio||i||n.stop(u._id)};n._endTimers[u._id]=setTimeout(_,1e3*p/Math.abs(n._rate)),u._paused=!1,u._ended=!1,u._sprite=e,u._seek=c,u._start=n._sprite[e][0]/1e3,u._stop=(n._sprite[e][0]+n._sprite[e][1])/1e3,u._loop=!(!u._loop&&!n._sprite[e][2]);var l=u._node;if(n._webAudio){var d=function(){n._refreshBuffer(u);var e=u._muted||n._muted?0:u._volume*s.volume();l.gain.setValueAtTime(e,t.currentTime),u._playStart=t.currentTime,"undefined"==typeof l.bufferSource.start?u._loop?l.bufferSource.noteGrainOn(0,c,86400):l.bufferSource.noteGrainOn(0,c,p):u._loop?l.bufferSource.start(0,c,86400):l.bufferSource.start(0,c,p),n._endTimers[u._id]||(n._endTimers[u._id]=setTimeout(_,1e3*p/Math.abs(n._rate))),i[1]||setTimeout(function(){n._emit("play",u._id)},0)};n._loaded?d():(n.once("load",d),n._clearTimer(u._id))}else{var f=function(){l.currentTime=c,l.muted=u._muted||n._muted||s._muted||l.muted,l.volume=u._volume*s.volume(),l.playbackRate=n._rate,setTimeout(function(){l.play(),i[1]||n._emit("play",u._id)},0)};if(4===l.readyState||!l.readyState&&navigator.isCocoonJS)f();else{var h=function(){n._endTimers[u._id]=setTimeout(_,1e3*p/Math.abs(n._rate)),f(),l.removeEventListener("canplaythrough",h,!1)};l.addEventListener("canplaythrough",h,!1),n._clearTimer(u._id)}}return u._id},pause:function(e){var t=this;if(!t._loaded)return t.once("play",function(){t.pause(e)}),t;for(var n=t._getSoundIds(e),i=0;i<n.length;i++){t._clearTimer(n[i]);var o=t._soundById(n[i]);if(o&&!o._paused){if(o._seek=t.seek(n[i]),o._paused=!0,t._webAudio){if(!o._node.bufferSource)return t;"undefined"==typeof o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),o._node.bufferSource=null}else isNaN(o._node.duration)||o._node.pause();arguments[1]||t._emit("pause",o._id)}}return t},stop:function(e){var t=this;if(!t._loaded)return"undefined"!=typeof t._sounds[0]._sprite&&t.once("play",function(){t.stop(e)}),t;for(var n=t._getSoundIds(e),i=0;i<n.length;i++){t._clearTimer(n[i]);var o=t._soundById(n[i]);if(o&&!o._paused)if(o._seek=o._start||0,o._paused=!0,o._ended=!0,t._webAudio&&o._node){if(!o._node.bufferSource)return t;"undefined"==typeof o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),o._node.bufferSource=null}else o._node&&!isNaN(o._node.duration)&&(o._node.pause(),o._node.currentTime=o._start||0)}return t},mute:function(e,n){var i=this;if(!i._loaded)return i.once("play",function(){i.mute(e,n)}),i;if("undefined"==typeof n){if("boolean"!=typeof e)return i._muted;i._muted=e}for(var o=i._getSoundIds(n),r=0;r<o.length;r++){var a=i._soundById(o[r]);a&&(a._muted=e,i._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume*s.volume(),t.currentTime):a._node&&(a._node.muted=s._muted?!0:e))}return i},volume:function(){var e,n,i=this,o=arguments;if(0===o.length)return i._volume;if(1===o.length){var r=i._getSoundIds(),a=r.indexOf(o[0]);a>=0?n=parseInt(o[0],10):e=parseFloat(o[0])}else 2===o.length&&(e=parseFloat(o[0]),n=parseInt(o[1],10));var u;if(!("undefined"!=typeof e&&e>=0&&1>=e))return u=n?i._soundById(n):i._sounds[0],u?u._volume:0;if(!i._loaded)return i.once("play",function(){i.volume.apply(i,o)}),i;"undefined"==typeof n&&(i._volume=e),n=i._getSoundIds(n);for(var c=0;c<n.length;c++)u=i._soundById(n[c]),u&&(u._volume=e,i._webAudio&&u._node?u._node.gain.setValueAtTime(e*s.volume(),t.currentTime):u._node&&(u._node.volume=e*s.volume()));return i},fade:function(e,n,i,o){var r=this;if(!r._loaded)return r.once("play",function(){r.fade(e,n,i,o)}),r;r.volume(e,o);for(var s=r._getSoundIds(o),a=0;a<s.length;a++){var u=r._soundById(s[a]);if(u)if(r._webAudio){var c=t.currentTime,p=c+i/1e3;u._volume=e,u._node.gain.setValueAtTime(e,c),u._node.gain.linearRampToValueAtTime(n,p),setTimeout(function(e,i){setTimeout(function(){i._volume=n,r._emit("faded",e)},p-t.currentTime>0?Math.ceil(1e3*(p-t.currentTime)):0)}.bind(r,s[a],u),i)}else{var _=Math.abs(e-n),l=e>n?"out":"in",d=_/.01,f=i/d;!function(){var t=e,i=setInterval(function(e){t+="in"===l?.01:-.01,t=Math.max(0,t),t=Math.min(1,t),t=Math.round(100*t)/100,r.volume(t,e),t===n&&(clearInterval(i),r._emit("faded",e))}.bind(r,s[a]),f)}()}}return r},loop:function(){var e,t,n,i=this,o=arguments;if(0===o.length)return i._loop;if(1===o.length){if("boolean"!=typeof o[0])return n=i._soundById(parseInt(o[0],10)),n?n._loop:!1;e=o[0],i._loop=e}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var r=i._getSoundIds(t),s=0;s<r.length;s++)n=i._soundById(r[s]),n&&(n._loop=e,i._webAudio&&n._node&&(n._node.bufferSource.loop=e));return i},seek:function(){var e,n,i=this,o=arguments;if(0===o.length)n=i._sounds[0]._id;else if(1===o.length){var r=i._getSoundIds(),s=r.indexOf(o[0]);s>=0?n=parseInt(o[0],10):(n=i._sounds[0]._id,e=parseFloat(o[0]))}else 2===o.length&&(e=parseFloat(o[0]),n=parseInt(o[1],10));if("undefined"==typeof n)return i;if(!i._loaded)return i.once("load",function(){i.seek.apply(i,o)}),i;var a=i._soundById(n);if(a){if(!(e>=0))return i._webAudio?a._seek+(i.playing(n)?t.currentTime-a._playStart:0):a._node.currentTime;var u=i.playing(n);u&&i.pause(n,!0),a._seek=e,i._clearTimer(n),u&&i.play(n,!0)}return i},playing:function(e){var t=this,n=t._soundById(e)||t._sounds[0];return n?!n._paused:!1},duration:function(){return this._duration},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++){t[n]._paused||(e.stop(t[n]._id),e._emit("end",t[n]._id)),e._webAudio||(t[n]._node.src="",t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener("canplaythrough",t[n]._loadFn,!1)),delete t[n]._node,e._clearTimer(t[n]._id);var i=s._howls.indexOf(e);i>=0&&s._howls.splice(i,1)}return c&&delete c[e._src],e=null,null},on:function(e,t,n){var i=this,o=i["_on"+e];return"function"==typeof t&&o.push({id:n,fn:t}),i},off:function(e,t,n){var i=this,o=i["_on"+e];if(t){for(var r=0;r<o.length;r++)if(t===o[r].fn&&n===o[r].id){o.splice(r,1);break}}else o=[];return i},once:function(e,t,n){var i=this,o=function(){t.apply(i,arguments),i.off(e,o,n)};return i.on(e,o,n),i},_emit:function(e,t,n){for(var i=this,o=i["_on"+e],r=0;r<o.length;r++)o[r].id&&o[r].id!==t||setTimeout(function(e){e.call(this,t,n)}.bind(i,o[r].fn),0);return i},_clearTimer:function(e){var t=this;return t._endTimers[e]&&(clearTimeout(t._endTimers[e]),delete t._endTimers[e]),t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new u(e)},_drain:function(){var e=this,t=e._pool,n=0,i=0;if(!(e._sounds.length<t)){for(i=0;i<e._sounds.length;i++)e._sounds[i]._ended&&n++;for(i=e._sounds.length-1;i>=0;i--){if(t>=n)return;e._sounds[i]._ended&&(e._webAudio&&e._sounds[i]._node&&e._sounds[i]._node.disconnect(0),e._sounds.splice(i,1),n--)}}},_getSoundIds:function(e){var t=this;if("undefined"==typeof e){for(var n=[],i=0;i<t._sounds.length;i++)n.push(t._sounds[i]._id);return n}return[e]},_refreshBuffer:function(e){var n=this;return e._node.bufferSource=t.createBufferSource(),e._node.bufferSource.buffer=c[n._src],e._node.bufferSource.connect(e._panner?e._panner:e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.value=n._rate,n}};var u=function(e){this._parent=e,this.init()};if(u.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._muted=t._muted,e._seek=0,e._paused=!0,e._ended=!0,e._id=Math.round(Date.now()*Math.random()),t._sounds.push(e),e.create(),e},create:function(){var e=this,n=e._parent,i=s._muted||e._muted||e._parent._muted?0:e._volume*s.volume();return n._webAudio?(e._node="undefined"==typeof t.createGain?t.createGainNode():t.createGain(),e._node.gain.setValueAtTime(i,t.currentTime),e._node.paused=!0,e._node.connect(o)):(e._node=new Audio,e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener("canplaythrough",e._loadFn,!1),e._node.src=n._src,e._node.preload="auto",e._node.volume=i,e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._muted=t._muted,e._seek=0,e._paused=!0,e._ended=!0,e._sprite=null,e._id=Math.round(Date.now()*Math.random()),e},_errorListener:function(){var e=this;e._node.error&&4===e._node.error.code&&(s.noAudio=!0),e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorListener,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t._emit("load")),t._autoplay&&t.play(),e._node.removeEventListener("canplaythrough",e._loadFn,!1)}},n)var c={},p=function(e){var t=e._src;if(c[t])return e._duration=c[t].duration,void d(e);if(/^data:[^;]+;base64,/.test(t)){window.atob=window.atob||function(e){for(var t,n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=String(e).replace(/=+$/,""),r=0,s=0,a="";n=o.charAt(s++);~n&&(t=r%4?64*t+n:n,r++%4)?a+=String.fromCharCode(255&t>>(-2*r&6)):0)n=i.indexOf(n);return a};for(var n=atob(t.split(",")[1]),i=new Uint8Array(n.length),o=0;o<n.length;++o)i[o]=n.charCodeAt(o);l(i.buffer,e)}else{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){l(r.response,e)},r.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete c[t],e.load())},_(r)}},_=function(e){try{e.send()}catch(t){e.onerror()}},l=function(e,n){t.decodeAudioData(e,function(e){e&&(c[n._src]=e,d(n,e))},function(){n._emit("loaderror")})},d=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e._emit("load")),e._autoplay&&e.play()};"function"==typeof define&&define.amd&&define("howler",function(){return{Howler:s,Howl:a}}),"undefined"!=typeof exports&&(exports.Howler=s,exports.Howl=a),"undefined"!=typeof window&&(window.HowlerGlobal=r,window.Howler=s,window.Howl=a,window.Sound=u)}(),/*! Effects Plugin */
!function(){"use strict";HowlerGlobal.prototype.init=function(e){return function(){var t=this;return t._pos=[0,0,0],t._orientation=[0,0,-1,0,1,0],t._velocity=[0,0,0],t._listenerAttr={dopplerFactor:1,speedOfSound:343.3},e.call(this,o)}}(HowlerGlobal.prototype.init),HowlerGlobal.prototype.pos=function(e,t,n){var i=this;return i.ctx&&i.ctx.listener?(t="number"!=typeof t?i._pos[1]:t,n="number"!=typeof n?i._pos[2]:n,"number"!=typeof e?i._pos:(i._pos=[e,t,n],i.ctx.listener.setPosition(i._pos[0],i._pos[1],i._pos[2]),i)):i},HowlerGlobal.prototype.orientation=function(e,t,n,i,o,r){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,n="number"!=typeof n?a[2]:n,i="number"!=typeof i?a[3]:i,o="number"!=typeof o?a[4]:o,r="number"!=typeof r?a[5]:r,"number"!=typeof e?a:(s._orientation=[e,t,n,i,o,r],s.ctx.listener.setOrientation(a[0],a[1],a[2],a[3],a[4],a[5]),s)},HowlerGlobal.prototype.velocity=function(e,t,n){var i=this;return i.ctx&&i.ctx.listener?(t="number"!=typeof t?i._velocity[1]:t,n="number"!=typeof n?i._velocity[2]:n,"number"!=typeof e?i._velocity:(i._velocity=[e,t,n],i.ctx.listener.setVelocity(i._velocity[0],i._velocity[1],i._velocity[2]),i)):i},HowlerGlobal.prototype.listenerAttr=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;var n=t._listenerAttr;return e?(t._listenerAttr={dopplerFactor:"undefined"!=typeof e.dopplerFactor?e.dopplerFactor:n.dopplerFactor,speedOfSound:"undefined"!=typeof e.speedOfSound?e.speedOfSound:n.speedOfSound},t.ctx.listener.dopplerFactor=n.dopplerFactor,t.ctx.listener.speedOfSound=n.speedOfSound,t):n},Howl.prototype.init=function(e){return function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._pos=t.pos||null,n._velocity=t.velocity||[0,0,0],n._pannerAttr={coneInnerAngle:"undefined"!=typeof t.coneInnerAngle?t.coneInnerAngle:360,coneOUterAngle:"undefined"!=typeof t.coneOUterAngle?t.coneOUterAngle:360,coneOuterGain:"undefined"!=typeof t.coneOuterGain?t.coneOuterGain:0,distanceModel:"undefined"!=typeof t.distanceModel?t.distanceModel:"inverse",maxDistance:"undefined"!=typeof t.maxDistance?t.maxDistance:1e4,panningModel:"undefined"!=typeof t.panningModel?t.panningModel:"HRTF",refDistance:"undefined"!=typeof t.refDistance?t.refDistance:1,rolloffFactor:"undefined"!=typeof t.rolloffFactor?t.rolloffFactor:1},e.call(this,t)}}(Howl.prototype.init),Howl.prototype.pos=function(t,n,i,o){var r=this;if(!r._webAudio)return r;if(!r._loaded)return r.once("play",function(){r.pos(t,n,i,o)}),r;if(n="number"!=typeof n?0:n,i="number"!=typeof i?-.5:i,"undefined"==typeof o){if("number"!=typeof t)return r._pos;r._pos=[t,n,i]}for(var s=r._getSoundIds(o),a=0;a<s.length;a++){var u=r._soundById(s[a]);if(u){if("number"!=typeof t)return u._pos;u._pos=[t,n,i],u._node&&(u._panner||e(u),u._panner.setPosition(t,n,i))}}return r},Howl.prototype.orientation=function(t,n,i,o){var r=this;if(!r._webAudio)return r;if(!r._loaded)return r.once("play",function(){r.orientation(t,n,i,o)}),r;if(n="number"!=typeof n?r._orientation[1]:n,i="number"!=typeof i?r._orientation[1]:i,"undefined"==typeof o){if("number"!=typeof t)return r._orientation;r._orientation=[t,n,i]}for(var s=r._getSoundIds(o),a=0;a<s.length;a++){var u=r._soundById(s[a]);if(u){if("number"!=typeof t)return u._orientation;u._orientation=[t,n,i],u._node&&(u._panner||e(u),u._panner.setOrientation(t,n,i))}}return r},Howl.prototype.velocity=function(t,n,i,o){var r=this;if(!r._webAudio)return r;if(!r._loaded)return r.once("play",function(){r.velocity(t,n,i,o)}),r;if(n="number"!=typeof n?r._velocity[1]:n,i="number"!=typeof i?r._velocity[1]:i,"undefined"==typeof o){if("number"!=typeof t)return r._velocity;r._velocity=[t,n,i]}for(var s=r._getSoundIds(o),a=0;a<s.length;a++){var u=r._soundById(s[a]);if(u){if("number"!=typeof t)return u._velocity;u._velocity=[t,n,i],u._node&&(u._panner||e(u),u._panner.setVelocity(t,n,i))}}return r},Howl.prototype.pannerAttr=function(){var t,n,i,o=this,r=arguments;if(!o._webAudio)return o;if(0===r.length)return o._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return i=o._soundById(parseInt(r[0],10)),i?i._pannerAttr:o._pannerAttr;t=r[0],"undefined"==typeof n&&(o._pannerAttr={coneInnerAngle:"undefined"!=typeof t.coneInnerAngle?t.coneInnerAngle:o._coneInnerAngle,coneOUterAngle:"undefined"!=typeof t.coneOUterAngle?t.coneOUterAngle:o._coneOUterAngle,coneOuterGain:"undefined"!=typeof t.coneOuterGain?t.coneOuterGain:o._coneOuterGain,distanceModel:"undefined"!=typeof t.distanceModel?t.distanceModel:o._distanceModel,maxDistance:"undefined"!=typeof t.maxDistance?t.maxDistance:o._maxDistance,panningModel:"undefined"!=typeof t.panningModel?t.panningModel:o._panningModel,refDistance:"undefined"!=typeof t.refDistance?t.refDistance:o._refDistance,rolloffFactor:"undefined"!=typeof t.rolloffFactor?t.rolloffFactor:o._rolloffFactor})}else 2===r.length&&(t=r[0],n=parseInt(r[1],10));for(var s=o._getSoundIds(n),a=0;a<s.length;a++)if(i=o._soundById(s[a])){var u=i._pannerAttr;u={coneInnerAngle:"undefined"!=typeof t.coneInnerAngle?t.coneInnerAngle:u.coneInnerAngle,coneOUterAngle:"undefined"!=typeof t.coneOUterAngle?t.coneOUterAngle:u.coneOUterAngle,coneOuterGain:"undefined"!=typeof t.coneOuterGain?t.coneOuterGain:u.coneOuterGain,distanceModel:"undefined"!=typeof t.distanceModel?t.distanceModel:u.distanceModel,maxDistance:"undefined"!=typeof t.maxDistance?t.maxDistance:u.maxDistance,panningModel:"undefined"!=typeof t.panningModel?t.panningModel:u.panningModel,refDistance:"undefined"!=typeof t.refDistance?t.refDistance:u.refDistance,rolloffFactor:"undefined"!=typeof t.rolloffFactor?t.rolloffFactor:u.rolloffFactor};var c=i._panner;c?(c.coneInnerAngle=u.coneInnerAngle,c.coneOUterAngle=u.coneOUterAngle,c.coneOuterGain=u.coneOuterGain,c.distanceModel=u.distanceModel,c.maxDistance=u.maxDistance,c.panningModel=u.panningModel,c.refDistance=u.refDistance,c.rolloffFactor=u.rolloffFactor):(i._pos||(i._pos=o._pos||[0,0,-.5]),e(i))}return o},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._pos=n._pos,t._velocity=n._velocity,t._pannerAttr=n._pannerAttr,e.call(this),t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._pos=n._pos,t._velocity=n._velocity,t._pannerAttr=n._pannerAttr,e.call(this)}}(Sound.prototype.reset);var e=function(e){e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOUterAngle=e._pannerAttr.coneOUterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2]),e._panner.setVelocity(e._velocity[0],e._velocity[1],e._velocity[2]),e._panner.connect(e._node),e._paused||e._parent.pause(e._id).play(e._id)}}(),function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(e.jQuery)}(this,function(e){function t(e){if(e in _.style)return e;for(var t=["Moz","Webkit","O","ms"],n=e.charAt(0).toUpperCase()+e.substr(1),i=0;i<t.length;++i){var o=t[i]+n;if(o in _.style)return o}}function n(){return _.style[l.transform]="",_.style[l.transform]="rotateY(90deg)",""!==_.style[l.transform]}function i(e){return"string"==typeof e&&this.parse(e),this}function o(e,t,n){t===!0?e.queue(n):t?e.queue(t,n):e.each(function(){n.call(this)})}function r(t){var n=[];return e.each(t,function(t){t=e.camelCase(t),t=e.transit.propertyMap[t]||e.cssProps[t]||t,t=u(t),l[t]&&(t=u(l[t])),-1===e.inArray(t,n)&&n.push(t)}),n}function s(t,n,i,o){var s=r(t);e.cssEase[i]&&(i=e.cssEase[i]);var a=""+p(n)+" "+i;parseInt(o,10)>0&&(a+=" "+p(o));var u=[];return e.each(s,function(e,t){u.push(t+" "+a)}),u.join(", ")}function a(t,n){n||(e.cssNumber[t]=!0),e.transit.propertyMap[t]=l.transform,e.cssHooks[t]={get:function(n){var i=e(n).css("transit:transform");return i.get(t)},set:function(n,i){var o=e(n).css("transit:transform");o.setFromString(t,i),e(n).css({"transit:transform":o})}}}function u(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function c(e,t){return"string"!=typeof e||e.match(/^[\-0-9\.]+$/)?""+e+t:e}function p(t){var n=t;return"string"!=typeof n||n.match(/^[\-0-9\.]+/)||(n=e.fx.speeds[n]||e.fx.speeds._default),c(n,"ms")}e.transit={version:"0.9.12",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:!0,useTransitionEnd:!1};var _=document.createElement("div"),l={},d=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;l.transition=t("transition"),l.transitionDelay=t("transitionDelay"),l.transform=t("transform"),l.transformOrigin=t("transformOrigin"),l.filter=t("Filter"),l.transform3d=n();var f={transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"},h=l.transitionEnd=f[l.transition]||null;for(var y in l)l.hasOwnProperty(y)&&"undefined"==typeof e.support[y]&&(e.support[y]=l[y]);return _=null,e.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeInCubic:"cubic-bezier(.550,.055,.675,.190)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"},e.cssHooks["transit:transform"]={get:function(t){return e(t).data("transform")||new i},set:function(t,n){var o=n;o instanceof i||(o=new i(o)),t.style[l.transform]="WebkitTransform"!==l.transform||d?o.toString():o.toString(!0),e(t).data("transform",o)}},e.cssHooks.transform={set:e.cssHooks["transit:transform"].set},e.cssHooks.filter={get:function(e){return e.style[l.filter]},set:function(e,t){e.style[l.filter]=t}},e.fn.jquery<"1.8"&&(e.cssHooks.transformOrigin={get:function(e){return e.style[l.transformOrigin]},set:function(e,t){e.style[l.transformOrigin]=t}},e.cssHooks.transition={get:function(e){return e.style[l.transition]},set:function(e,t){e.style[l.transition]=t}}),a("scale"),a("scaleX"),a("scaleY"),a("translate"),a("rotate"),a("rotateX"),a("rotateY"),a("rotate3d"),a("perspective"),a("skewX"),a("skewY"),a("x",!0),a("y",!0),i.prototype={setFromString:function(e,t){var n="string"==typeof t?t.split(","):t.constructor===Array?t:[t];n.unshift(e),i.prototype.set.apply(this,n)},set:function(e){var t=Array.prototype.slice.apply(arguments,[1]);this.setter[e]?this.setter[e].apply(this,t):this[e]=t.join(",")},get:function(e){return this.getter[e]?this.getter[e].apply(this):this[e]||0},setter:{rotate:function(e){this.rotate=c(e,"deg")},rotateX:function(e){this.rotateX=c(e,"deg")},rotateY:function(e){this.rotateY=c(e,"deg")},scale:function(e,t){void 0===t&&(t=e),this.scale=e+","+t},skewX:function(e){this.skewX=c(e,"deg")},skewY:function(e){this.skewY=c(e,"deg")},perspective:function(e){this.perspective=c(e,"px")},x:function(e){this.set("translate",e,null)},y:function(e){this.set("translate",null,e)},translate:function(e,t){void 0===this._translateX&&(this._translateX=0),void 0===this._translateY&&(this._translateY=0),null!==e&&void 0!==e&&(this._translateX=c(e,"px")),null!==t&&void 0!==t&&(this._translateY=c(t,"px")),this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var e=(this.scale||"1,1").split(",");return e[0]&&(e[0]=parseFloat(e[0])),e[1]&&(e[1]=parseFloat(e[1])),e[0]===e[1]?e[0]:e},rotate3d:function(){for(var e=(this.rotate3d||"0,0,0,0deg").split(","),t=0;3>=t;++t)e[t]&&(e[t]=parseFloat(e[t]));return e[3]&&(e[3]=c(e[3],"deg")),e}},parse:function(e){var t=this;e.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(e,n,i){t.setFromString(n,i)})},toString:function(e){var t=[];for(var n in this)if(this.hasOwnProperty(n)){if(!l.transform3d&&("rotateX"===n||"rotateY"===n||"perspective"===n||"transformOrigin"===n))continue;"_"!==n[0]&&t.push(e&&"scale"===n?n+"3d("+this[n]+",1)":e&&"translate"===n?n+"3d("+this[n]+",0)":n+"("+this[n]+")")}return t.join(" ")}},e.fn.transition=e.fn.transit=function(t,n,i,r){var a=this,u=0,c=!0,_=e.extend(!0,{},t);"function"==typeof n&&(r=n,n=void 0),"object"==typeof n&&(i=n.easing,u=n.delay||0,c="undefined"==typeof n.queue?!0:n.queue,r=n.complete,n=n.duration),"function"==typeof i&&(r=i,i=void 0),"undefined"!=typeof _.easing&&(i=_.easing,delete _.easing),"undefined"!=typeof _.duration&&(n=_.duration,delete _.duration),"undefined"!=typeof _.complete&&(r=_.complete,delete _.complete),"undefined"!=typeof _.queue&&(c=_.queue,delete _.queue),"undefined"!=typeof _.delay&&(u=_.delay,delete _.delay),"undefined"==typeof n&&(n=e.fx.speeds._default),"undefined"==typeof i&&(i=e.cssEase._default),n=p(n);var d=s(_,n,i,u),f=e.transit.enabled&&l.transition,y=f?parseInt(n,10)+parseInt(u,10):0;if(0===y){var m=function(e){a.css(_),r&&r.apply(a),e&&e()};return o(a,c,m),a}var v={},g=function(t){var n=!1,i=function(){n&&a.unbind(h,i),y>0&&a.each(function(){this.style[l.transition]=v[this]||null}),"function"==typeof r&&r.apply(a),"function"==typeof t&&t()};y>0&&h&&e.transit.useTransitionEnd?(n=!0,a.bind(h,i)):window.setTimeout(i,y),a.each(function(){y>0&&(this.style[l.transition]=d),e(this).css(_)})},w=function(e){this.offsetWidth,g(e)};return o(a,c,w),this},e.transit.getTransitionValue=s,e}),function(){window.TPL=function(e){return JST["views/"+e]}}.call(this),function(){_.mixin({toRGB:function(e){var t,n;return n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,e=e.replace(n,function(e,t,n,i){return t+t+n+n+i+i}),t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.BaseView=function(t){function n(e){this.scene=e.scene,n.__super__.constructor.call(this,e)}return e(n,t),n.prototype._adjust_scale=function(){return this.$el.css({fontSize:1*this.app.view.current_scale})},n}(SUI.View)}.call(this),function(){this.JST||(this.JST={}),this.JST["views/application"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="scene-area">\n</div>\n');return __p.join("")}}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.ApplicationView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="application-view",n.prototype.template=TPL("application"),n.prototype.current_scale=1,n.prototype.initialize=function(){return this.screen_ratio=this.app.screen_ratio,this.screen_size=this.app.screen_size,this._render(),this._position(),this._adjust_size(),$(window).resize(function(e){return function(){return e._adjust_size()}}(this))},n.prototype.render_scene=function(e){return this.$scene_area.append(e.el)},n.prototype._render=function(){return this.$el.html(this.template()),this.$scene_area=this.$(".scene-area")},n.prototype._position=function(){return $("body").append(this.el)},n.prototype._adjust_size=function(){var e,t,n,i,o;return e=this.screen_ratio.width/this.screen_ratio.height,o=$(window).width(),i=$(window).height(),n=$(window).height()*e,t=i,n>o&&(n=o,t=n/e),this.$el.css({width:n,height:t,marginLeft:n*-.5,marginTop:t*-.5}),this.current_scale=n/this.screen_size.width,this.app.trigger("scale-changed",this.current_scale)},n}(SUI.View)}.call(this),function(){this.JST||(this.JST={}),this.JST["views/choices_pointer"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="title">\n  <span class="text">',title,'</span>\n</div>\n<div class="description">\n  <span class="text">',description,"</span>\n</div>\n\n<div class='background-wrap'>\n  <div class=\"choice-list\"></div>\n</div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["views/choices_text"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="content">\n  <div class="header">\n    <div class="title">',title,'</div>\n    <div class="description">',description,"</div>\n  </div>\n  <div class=\"choice-list\">\n  </div>\n</div>\n<div class='background-wrap'>\n</div>\n");return __p.join("")}}.call(this),function(){var extend=function(e,t){function n(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;PiG.View.ChoicesView=function(superClass){function ChoicesView(){return ChoicesView.__super__.constructor.apply(this,arguments)}return extend(ChoicesView,superClass),ChoicesView.prototype.className="choices-view",ChoicesView.prototype.template=function(e,t){return this._template=function(){switch(e){case"pointer":return TPL("choices_pointer");default:return TPL("choices_text")}}(),this._template(t)},ChoicesView.prototype.item_view_classes={text:"PiG.View.TextChoiceView",pointer:"PiG.View.PointerChoiceView"},ChoicesView.prototype.default_render_options={title:"",description:""},ChoicesView.prototype.default_visual_options={background_asset_id:null,background_color:"000000",background_opacity:.7},ChoicesView.prototype.default_choice_options={type:"text",font_size:46,radius:50},ChoicesView.prototype.initialize=function(e){return this.render_options=_(e).pick("title","description"),this.visual_options=_(e).pick("background_asset_id","background_color","background_opacity"),this.choice_options={type:e.choice_type,font_size:e.choice_font_size,radius:e.choice_radius},_(this.render_options).defaults(this.default_render_options),_(this.visual_options).defaults(this.default_visual_options),_(this.choice_options).defaults(this.default_choice_options),this.choices=new PiG.Collection.Choices(e.choices),this._render(),this._render_background(),this._render_choices(),this._adjust_scale(),this._position(e.layer_id||"subtitles"),this.listenTo(this.app,"scale-changed",this._adjust_scale),this.show()},ChoicesView.prototype.events={click:"prevent_click"},ChoicesView.prototype.prevent_click=function(e){return e.stopPropagation()},ChoicesView.prototype.show=function(){var e,t;return t=this.$background_wrap.prop("scrollWidth"),e=this.$background_wrap.prop("scrollHeight"),this.$background_wrap.scrollLeft((t-this.app.view.$el.width())/2),this.$background_wrap.scrollTop((e-this.app.view.$el.height())/2),this.scene.view.register_receiver(this),this.$el.transition({y:"0",opacity:1},800,function(){return function(){}}(this)),this._show_choice_items()},ChoicesView.prototype.hide=function(e){return this.scene.view.unregister_receiver(),this.$el.transition({y:"2%",opacity:0},800,function(){return function(){return e instanceof Function?e():void 0}}(this))},ChoicesView.prototype._render=function(){return this.$el.html(this.template(this.choice_options.type,this.render_options)),this.$el.addClass(this.choice_options.type+"-type"),this.$choice_list=this.$(".choice-list"),this.$background_wrap=this.$(".background-wrap"),this.$el.css({opacity:0,y:"2%"})},ChoicesView.prototype._render_background=function(){var e,t,n;return n=_(this.visual_options.background_color).toRGB(),this.$el.css("background-color","rgba("+n.r+","+n.g+","+n.b+","+this.visual_options.background_opacity+")"),this.visual_options.background_asset_id?(e=this.app.game.assets.get(this.visual_options.background_asset_id),t=new PiG.View.ImageView({app:this.app,parent:this,asset:e,wrapper_el:this.$background_wrap[0]}),this.$choice_list.css({width:t.el.style.width,height:t.el.style.height})):void 0},ChoicesView.prototype._render_choices=function(){return this._choice_items=[],this.choices.each(function(_this){return function(choice){var choice_view,item_options,item_view_class;return item_options={app:_this.app,parent:_this,scene:_this.scene,model:choice},item_view_class=eval(_this.item_view_classes[_this.choice_options.type]),choice_view=new item_view_class(_(item_options).defaults(_this.choice_options)),_this._choice_items.push(choice_view)}}(this))},ChoicesView.prototype._show_choice_items=function(){return _(this._choice_items).each(function(e,t){return setTimeout(function(){return function(){return e.show()}}(this),300*t)})},ChoicesView.prototype._position=function(e){var t;return t=this.scene.layers.get(e),t.view.$el.append(this.el)},ChoicesView}(PiG.View.BaseView)}.call(this),function(){this.JST||(this.JST={}),this.JST["views/conversation"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="conversation-block">\n  <div class="name-label">\n    <span class=\'name\'></span>\n  </div>\n\n  <div class="message-area">\n    <div class=\'message\'>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.ConversationView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="conversation-view",n.prototype.template=TPL("conversation"),n.prototype.default_message_options={speed:10,font_size:28},n.prototype.initialize=function(e){return this.current_message_index=0,this.scene=e.scene,this.messages=new PiG.Collection.Messages(e.messages),this._render(),this._adjust_scale(),this._position(e.layer_id||"subtitles"),this.listenTo(this.app,"scale-changed",this._adjust_scale),this.show()},n.prototype.events={click:"skip_animation_or_next"},n.prototype.skip_animation_or_next=function(e){var t;return e.stopPropagation(),this._typing?(this._stop_typing(),this._show_message(this.current_message_index)):(t=this.current_message_index+1,this.messages.at(t)?(this._stop_typing(),this._show_message(t,{typing:!0})):this.hide(function(e){return function(){return e.remove(),e.scene.view.next()}}(this)))},n.prototype.show=function(){return this.scene.view.register_receiver(this),this.$el.transition({y:"0",opacity:1},800,function(e){return function(){return e._show_message(0,{typing:!0})}}(this))},n.prototype.hide=function(e){return this.scene.view.unregister_receiver(),this.$el.transition({y:"15%",opacity:0},800,function(){return function(){return e instanceof Function?e():void 0}}(this))},n.prototype._show_message=function(e,t){var n,i,o;return null==t&&(t={}),o=this.messages.at(e),n=this.scene.actors.get(o.get("actor_id")),_(o.attributes).defaults(this.default_message_options),n&&(i=n.get("short_name"))?(this.$name.html(n.get("short_name")),this.$el.addClass("show-name-label")):this.$el.removeClass("show-name-label"),this.$message.css({fontSize:o.get("font_size")+"em"}),this.$message.empty(),t.typing?this._type_message(o.get("message"),o.get("speed")):this.$message.html(o.get("message")),this.current_message_index=e},n.prototype._type_message=function(e,t){return this._stop_typing(),e?(this.$message.append("<span class='letter'>"+e[0]+"</span>"),this.$message_area.scrollTop(this.$message_area.prop("scrollHeight")-this.$message_area.height()),this._typing=setTimeout(function(n){return function(){return n._type_message(e.substring(1),t)}}(this),t)):void 0},n.prototype._stop_typing=function(){return clearTimeout(this._typing),delete this._typing},n.prototype._render=function(){return this.$el.html(this.template()),this.$el.css({opacity:0,y:"15%"}),this.$name=this.$(".name"),this.$message=this.$(".message"),this.$message_area=this.$(".message-area")},n.prototype._adjust_scale=function(){return this.$el.css({fontSize:1*this.app.view.current_scale})},n.prototype._position=function(e){var t;return t=this.scene.layers.get(e),t.view.$el.append(this.el)},n}(PiG.View.BaseView)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.ImageView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="image-view",n.prototype.animate_attributes=["scale","origin","position","opacity"],n.prototype.initialize=function(e){return null==e&&(e={}),this.scene=e.scene,this.asset=e.asset,this.scale=_(e.scale).isUndefined()?1:e.scale,this.opacity=_(e.opacity).isUndefined()?1:e.opacity,this.origin=e.origin||{x:0,y:0},this.position=e.position||{x:0,y:0},this._render(),e.layer_id&&this._position_to_layer(e.layer_id),e.wrapper_el?this._position_to_element(e.wrapper_el):void 0},n.prototype.animate=function(e,t){var n,i;return i={},n={},_(this.animate_attributes).each(function(t){return _(e[t]).isUndefined()?void 0:_(e[t]).isArray()?(i[t]=e[t][0],n[t]=e[t][1]):n[t]=e[t]}),this.$el.css(this._convert_position_attr(i)),this.$el.transition(this._convert_position_attr(n),e.duration,function(){return function(){return t instanceof Function?t():void 0}}(this))},n.prototype._render=function(){var e,t,n,i,o,r;return o=parseInt(this.asset.get("width")),e=parseInt(this.asset.get("height")),r=o/this.app.screen_size.width*100,t=e/this.app.screen_size.height*100,n=e/this.app.screen_size.width*100,i={width:r+"%",height:t+"%",marginLeft:r*this.origin.x*-1+"%",marginTop:n*this.origin.y*-1+"%",position:this.position,opacity:this.opacity,scale:this.scale,transformOrigin:100*this.origin.x+"% "+100*this.origin.y+"%"},this.$el.css(this._convert_position_attr(i)),this.$image=$("<img src='"+this.asset.get("src")+"'>"),this.$el.append(this.$image)},n.prototype._position_to_layer=function(e){var t;return t=this.scene.layers.get(e),t.view.$el.append(this.el)},n.prototype._position_to_element=function(e){return this.$el.appendTo(e)},n.prototype._convert_position_attr=function(e){var t;return(t=e.position)?(t.x&&(e.left=100*t.x+"%"),t.y&&(e.top=100*t.y+"%"),delete e.position,e):e},n}(PiG.View.BaseView)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.LayerView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="layer-view",n.prototype.initialize=function(e){return this.scene=e.scene,this.model.view=this,this.$el.prop("id","layer-"+this.model.id),this.$el.css("z-index",this.model.get("z")),this.scene.view.$el.append(this.el)},n.prototype.shake=function(e){switch(console.log("shake",e),e.strength){case 1:return alert("weak...");case 2:return alert("STRONG!")}},n}(PiG.View.BaseView)}.call(this),function(){this.JST||(this.JST={}),this.JST["views/monologue"]=function(obj){var __p=[];with(obj||{})__p.push("<div class=\"message-area\">\n  <div class='message'>\n  </div>\n</div>\n");return __p.join("")}}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.MonologueView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="monologue-view",n.prototype.template=TPL("monologue"),n.prototype.default_voptions={opacity:.5,duration:800,speed:10,font_size:28,font_color:"ffffff",background_color:"000000",halign:"left",valign:"top"},n.prototype.initialize=function(e){return this.current_message_index=0,this.scene=e.scene,this.voptions=_(e).pick("opacity","duration","speed","font_size","font_color","background_color","halign","valign"),this.voptions=_(this.voptions).defaults(this.default_voptions),this._render(),this._adjust_scale(),this._position(e.layer_id||"subtitles"),this.listenTo(this.app,"scale-changed",this._adjust_scale),this.messages=e.messages,this.show()},n.prototype.events={click:"skip_animation_or_next"},n.prototype.skip_animation_or_next=function(e){var t;return e.stopPropagation(),this._typing?(this._stop_typing(),this._show_message(this.current_message_index)):(t=this.current_message_index+1,this.messages[t]?(this._stop_typing(),this._show_message(t,{typing:!0})):this.hide(function(e){return function(){return e.remove(),e.scene.view.next()}}(this)))},n.prototype.show=function(){return this.scene.view.register_receiver(this),this.$el.transition({opacity:1},this.voptions.duration,function(e){return function(){return e._show_message(0,{typing:!0})}}(this))},n.prototype.hide=function(e){return this.scene.view.unregister_receiver(),this.$el.transition({opacity:0},this.voptions.duration,function(){return function(){return e instanceof Function?e():void 0}}(this))},n.prototype._show_message=function(e,t){var n;return null==t&&(t={}),n=this.messages[e],this.$message.css({fontSize:this.voptions.font_size+"em"}),this.$message.empty(),t.typing?this._type_message(n,this.voptions.speed):this.$message.html(n),this.current_message_index=e},n.prototype._type_message=function(e,t){return this._stop_typing(),e?(this.$message.append("<span class='letter'>"+e[0]+"</span>"),this.$message_area.scrollTop(this.$message_area.prop("scrollHeight")-this.$message_area.height()),this._typing=setTimeout(function(n){return function(){return n._type_message(e.substring(1),t)}}(this),t)):void 0},n.prototype._stop_typing=function(){return clearTimeout(this._typing),delete this._typing},n.prototype._render=function(){var e,t;return this.$el.html(this.template()),this.$el.css({opacity:0}),this.$message=this.$(".message"),this.$message_area=this.$(".message-area"),t=_(this.voptions.font_color).toRGB(),e=_(this.voptions.background_color).toRGB(),this.$el.css("color","rgb("+t.r+", "+t.g+", "+t.b+")"),this.$el.css("background-color","rgba("+e.r+", "+e.g+", "+e.b+", "+this.voptions.opacity+")"),this.$el.addClass("align-"+this.voptions.halign),this.$el.addClass("valign-"+this.voptions.valign)},n.prototype._adjust_scale=function(){return this.$el.css({fontSize:1*this.app.view.current_scale})},n.prototype._position=function(e){var t;return t=this.scene.layers.get(e),t.view.$el.append(this.el)},n}(PiG.View.BaseView)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.PointerChoiceView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="choice-item",n.prototype.initialize=function(){return this.current_event_index=0,this._render(),this._position()},n.prototype.events={click:"run_events"},n.prototype.run_events=function(){return this.parent.hide(function(e){return function(){return e.scene.view.perform_dynamic_events(e.model.get("dynamic_events")),e.parent.remove()}}(this))},n.prototype.show=function(){return this.$el.transition({opacity:1},1e3)},n.prototype._render=function(){return this.$el.append("<div class='dot'></div>"),this.$el.css({left:100*this.model.get("position").x+"%",top:100*this.model.get("position").y+"%"})},n.prototype._position=function(){return this.parent.$choice_list.append(this.el)},n}(PiG.View.BaseView)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e
},t={}.hasOwnProperty;PiG.View.SceneView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="scene-view",n.prototype.initialize=function(e){return this._init_associations(e),this._render(),this._render_layer_views(),this._position(),this._start_from(this.current_event_index)},n.prototype._init_associations=function(e){return this.model.view=this,this.dynamic_event_queue=[],this.current_event_index=e.current_event_index||0,this.layer_manager=new PiG.Helper.ViewManager,this.view_manager=new PiG.Helper.ViewManager,this.audio_manager=new PiG.Helper.ViewManager},n.prototype.events={click:"next"},n.prototype.next=function(e){return e&&this._receiver?this._receiver.$el.trigger(e.type,e):this.dynamic_event_queue.length?this._perform_next_dynamic_event():this.perform_next_event()},n.prototype.perform_next_event=function(){var e,t;return t=this.current_event_index+1,(e=this.model.events.at(t))?(this.perform_event(e),this.current_event_index=t):void 0},n.prototype.perform_event=function(e){var t,n;return(n=e.get("layer")?this.layer_manager.get(e.get("layer")):e.get("view")?this.view_manager.get(e.get("view")):this)?(console.log(e.toJSON()),n[e.get("method")](e.get("options")),e.get("auto_next")?(t=_(this.next).bind(this),_(t).delay(e.get("auto_next"))):void 0):void 0},n.prototype.perform_post_events=function(e){var t;return t=0,this._receiver=void 0,this.model.post_scene_events.each(function(e){return function(n){return e.perform_event(n),n.get("wait")>t?t=n.get("wait"):void 0}}(this)),setTimeout(e,t+100)},n.prototype.perform_dynamic_events=function(e){return this.dynamic_event_queue=e.concat(this.dynamic_event_queue),this._perform_next_dynamic_event()},n.prototype._perform_next_dynamic_event=function(){var e,t,n;switch(n=this.dynamic_event_queue.shift(),!1){case"next"!==n:return this.perform_next_event();case"back"!==n:return t=this.model.events.at(this.current_event_index),this.perform_event(t);case!(n instanceof Object):return this.perform_event(new this.model.events.model(n));default:return e=this.model.dynamic_events.get(n),this.perform_event(e)}},n.prototype.fade=function(e){var t,n;return n={},t={},_(e.opacity).isArray()?(n.opacity=e.opacity[0],t.opacity=e.opacity[1]):t.opacity=e.opacity,this.$el.css(n),this.$el.animate(t,e.duration)},n.prototype.register_receiver=function(e){return this._receiver=e},n.prototype.unregister_receiver=function(){return this._receiver=void 0},n.prototype.new_image=function(e){var t;return null==e&&(e={}),t=new PiG.View.ImageView(_(e).defaults({app:this.app,scene:this.model,asset:this.app.game.assets.get(e.asset_id)})),this.view_manager.add(e.view_id,t),t},n.prototype.new_conversation=function(e){var t;return null==e&&(e={}),t=new PiG.View.ConversationView(_(e).defaults({app:this.app,scene:this.model})),this.view_manager.add(e.view_id,t),t},n.prototype.new_monologue=function(e){var t;return null==e&&(e={}),t=new PiG.View.MonologueView(_(e).defaults({app:this.app,scene:this.model})),this.view_manager.add(e.view_id,t),t},n.prototype.new_choices=function(e){var t;return t=new PiG.View.ChoicesView(_(e).defaults({app:this.app,scene:this.model})),this.view_manager.add(e.view_id,t),t},n.prototype.switch_background=function(e){return e.duration=e.duration/2,this.fade_out_image(e,function(t){return function(){return e.layer_id="background",t.fade_in_image(e)}}(this))},n.prototype.play_audio=function(e){var t,n;return null==e&&(e={}),_(e).defaults({loop:!1,restart:!0}),t=this.app.game.assets.get(e.asset_id),n=t.audio,n.volume(1),e.loop&&n.loop(),(!n.playing()||n.playing()&&e.restart)&&n.play(),this.audio_manager.add(e.audio_id,n)},n.prototype.stop_audio=function(e){var t;return t=this.audio_manager.get(e.audio_id),e.fade>0?t.fade(1,0,e.fade,function(){return function(){return t.stop()}}(this)):t.stop()},n.prototype.change_scene=function(e){var t;return t=this.app.game.scenes.get(e.scene_id),this.app.navigate("scenes/"+t.id,{trigger:!0})},n.prototype.fade_in_image=function(e,t){var n;return e.opacity=0,n=this.new_image(e),e.opacity=1,n.animate(e,e.duration,function(){return function(){return t instanceof Function?t():void 0}}(this))},n.prototype.fade_out_image=function(e,t){var n;return n=this.view_manager.get(e.view_id,n),e.opacity=[1,0],n.animate(e,function(i){return function(){return n.remove(),i.view_manager.remove(e.view_id),t instanceof Function?t():void 0}}(this))},n.prototype._render=function(){return this.$el.css(this.model.get("options"))},n.prototype._render_layer_views=function(){return this.model.layers.each(function(e){return function(t){return t.view=new PiG.View.LayerView({app:e.app,parent:e,model:t,scene:e.model}),e.layer_manager.add(t.id,t.view)}}(this))},n.prototype._position=function(){return this.app.view.render_scene(this)},n.prototype._start_from=function(e){return this.model.pre_scene_events.each(function(e){return function(t){return e.perform_event(t)}}(this)),_(this.model.events.first(e+1)).each(function(e){return function(t,n){return e.perform_event(t),e.current_event_index=n}}(this))},n}(SUI.View)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.LimitedTimeSceneView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="limited-time-scene scene-view",n.prototype.limited_time=0,n.prototype.initialize=function(e){return this._init_associations(e),this._init_time(),this._render(),this._render_layer_views(),this._render_time_indicator(),this._position(),this._start_from(this.current_event_index),this.model.get("options").realtime?this._countdown_limited_time_as_reatime():void 0},n.prototype.spend_time=function(e){return this.limited_time.subtract(e.time)},n.prototype._init_time=function(){return this.limited_time=new PiG.Model.LimitedTimeScene.Time({time:this.model.get("options").time})},n.prototype._render_time_indicator=function(){var e;return e=this.layer_manager.get(this.model.get("options").indicator_layer),new PiG.View.TimeIndicatorView({app:this.app,parent:this,scene:this.model,layer_view:e,model:this.limited_time})},n.prototype._countdown_limited_time_as_reatime=function(){return this._countdown=setInterval(function(e){return function(){return e.limited_time.subtract(1),e.limited_time.get("seconds")<=0?clearInterval(e._countdown):void 0}}(this),1e3)},n}(PiG.View.SceneView)}.call(this),function(){this.JST||(this.JST={}),this.JST["views/scenes/time_indicator"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="time-block">\n  <div class="time-strings"></div>\n</div>\n');return __p.join("")}}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.TimeIndicatorView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="time-indicator-view",n.prototype.template=TPL("scenes/time_indicator"),n.prototype.default_options={format:"[mm][:][ss]",font_size:36},n.prototype.initialize=function(e){return this.layer_view=e.layer_view,this.options=_(this.scene.get("options")).pick("format","font_size"),_(this.options).defaults(this.default_options),this._render(),this._position(),this._adjust_scale(),this.listenTo(this.model,"change:seconds",this._render)},n.prototype._render=function(){return this.$el.html(this.template()),this.$(".time-strings").css("font-size",this.options.font_size+"em").html(this._parse_time_format(this.model.humanize())),this.scene.get("options").realtime?this.$(".time-separator").addClass("blinking"):void 0},n.prototype._position=function(){return this.layer_view.$el.append(this.el)},n.prototype._parse_time_format=function(e){return this.options.format.replace("[:]","<span class='time-separator'>:</span>").replace("[hh]",this._time_string_tpl("hours",e.hours,!0)).replace("[mm]",this._time_string_tpl("minutes",e.minutes,!0)).replace("[ss]",this._time_string_tpl("seconds",e.seconds,!0)).replace("[h]",this._time_string_tpl("hours",e.hours,!1)).replace("[m]",this._time_string_tpl("minutes",e.minutes,!1)).replace("[s]",this._time_string_tpl("seconds",e.seconds,!1))},n.prototype._time_string_tpl=function(e,t,n){return n&&(t=("0"+t).substr(-2)),"<span class='"+e+" time-string'>"+t+"</span>"},n}(PiG.View.BaseView)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.View.TextChoiceView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="choice-item",n.prototype.initialize=function(e){return this.current_event_index=0,this.font_size=e.font_size,this.radius=e.radius,this._render(),this._position()},n.prototype.events={click:"run_events"},n.prototype.run_events=function(){return this.parent.hide(function(e){return function(){return e.scene.view.perform_dynamic_events(e.model.get("dynamic_events")),e.parent.remove()}}(this))},n.prototype.show=function(){return this.$el.transition({opacity:1},1e3)},n.prototype._render=function(){return this.$text=$("<span class='text'>"+this.model.get("text")+"</span>"),this.$el.html(this.$text),this.$el.css({"border-radius":this.radius+"em",opacity:0}),this.$text.css("font-size",this.font_size+"em")},n.prototype._position=function(){return this.parent.$choice_list.append(this.el)},n}(PiG.View.BaseView)}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;PiG.SceneManager=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.screen_ratio={width:2,height:3},n.prototype.screen_size={width:640,height:960},n.prototype.initialize=function(e){return null==e&&(e={}),this.view=new PiG.View.ApplicationView({app:this}),this.game=new PiG.Model.Game,$.ajax({url:e.json,success:function(e){return function(t){return e.game.init_game_data_from(t),e.game.preload_assets(function(){return Backbone.history.start()})}}(this)})},n.prototype.routes={"":"move_to_first_scene","scenes/:scene_id":"show_scene_view"},n.prototype.move_to_first_scene=function(){return this.navigate("scenes/"+this.game.scenes.first().id,{trigger:!0})},n.prototype.show_scene_view=function(e){var t,n;return t=this.game.scenes.get(e),n=t.load_view_class(),this.render_scene(n,{model:t})},n.prototype.render_scene=function(e,t){var n;return null==t&&(t={}),t=_({app:this}).extend(t),n=function(n){return function(){return n._current_scene&&n._current_scene.remove(),n._current_scene=new e(t)}}(this),this._current_scene instanceof PiG.View.SceneView?this._current_scene.perform_post_events(n):n()},n}(SUI.Router)}.call(this);
